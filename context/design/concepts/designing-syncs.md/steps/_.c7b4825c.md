---
timestamp: 'Wed Nov 05 2025 16:02:52 GMT-0500 (Eastern Standard Time)'
parent: '[[../20251105_160252.1d463333.md]]'
content_id: c7b4825cc1b8efa3b4d4947955841e5638003aeed81aedf497cd987a8556a6bf
---

# Architecture Overview

The concept design approach structures its architecture entirely around two fundamental building blocks:

1. **Concepts**: Self-contained, modular increments of functionality (e.g., `Sessioning`, `Posting`, `Commenting`).
2. **Synchronizations**: The rules that orchestrate interactions *between* concepts (e.g., "when a post is deleted, delete all its comments").

## Directory Structure

> **Important:** You should only need to add code within the `src/concepts` and `src/syncs` directories.

```
context/
design/
src/
├── concepts/       <-- YOUR CONCEPTS HERE
│   ├── Sessioning/
│   │   └── SessioningConcept.ts
│   ├── Posting/
│   │   └── PostingConcept.ts
│   └── ...
├── syncs/          <-- YOUR SYNCHRONIZATIONS HERE
│   ├── auth.sync.ts
│   └── posts.sync.ts
│
├── engine/         <-- Framework-provided (ignore)
├── utils/          <-- Framework-provided (ignore)
└── main.ts         <-- Entry-point (can configure logging)
```

## The `Requesting` Concept: Application Entry-point

The architecture will automatically spin up an HTTP server for your application. However, you might wonder how exactly an external HTTP request triggers your logic. This is handled by the provided concept called `Requesting`.

When an HTTP request hits the server, the Concept Engine automatically translates it into a `Requesting.request` action. You don't implement this concept; you just use its actions as triggers in your synchronizations.

> **Important:** by default, `Requesting` also includes *passthrough routes* that automatically generate routes for direct access to concept actions and queries. Please read the [Requesting README](../../src/concepts/Requesting/README.md) for more details.

For example, an incoming request like `POST /api/posts/create` with a JSON body `{ "title": "My First Post", "content": "Hello world!", "session": "s123" }` is automatically converted into an action that looks like this:

`Requesting.request({ path: "/posts/create", title: "My First Post", content: "Hello world!", session: "s123" })`

You can then write a [synchronization](implementing-synchronizations.md) to "catch" this action and do something useful with it:

```typescript
// in src/syncs/posts.sync.ts
const CreatePostOnRequest: Sync = ({ title, content, session, user }) => ({
    when: actions(
        // Catches the request from the engine
        [Requesting.request, { path: "/posts/create", title, content, session }, {}],
    ),
    where: (frames) => {
        // Authorizes the request by checking the session
        return frames
            .query(Sessioning.getUser, { session }, { user });
    },
    then: actions(
        // If we got here, we found a logged in user
        [Posting.create, { title, content, author: user }],
    ),
});
```

By creating the `Sessioning` and `Posting` concepts and including this synchronization, you created an operational and authenticated API endpoint for creating posts. The `Requesting` concept encapsulates the concerns surrounding HTTP requests, and therefore abstracted away the need for specifying a HTTP server, controllers, middleware, etc.

## Initialization

1. Configure any environment variables you need in `.env`
2. Build command: `deno run build` to scan and automatically generate imports for concepts/syncs.
3. Start command: `deno run start` to begin your server.

```ts
/**

* Sample synchronizations: feel free to delete this entire file!

*/

  

import { LikertSurvey, Requesting } from "@concepts";

import { actions, Sync } from "@engine";

  

export const CreateSurveyRequest: Sync = (

{ request, author, title, scaleMin, scaleMax },

) => ({

when: actions([

Requesting.request,

{ path: "/LikertSurvey/createSurvey", author, title, scaleMin, scaleMax },

{ request },

]),

then: actions([LikertSurvey.createSurvey, {

author,

title,

scaleMin,

scaleMax,

}]),

});

  

export const CreateSurveyResponse: Sync = ({ request, survey }) => ({

when: actions(

[Requesting.request, { path: "/LikertSurvey/createSurvey" }, { request }],

[LikertSurvey.createSurvey, {}, { survey }],

),

then: actions([Requesting.respond, { request, survey }]),

});

  

export const AddQuestionRequest: Sync = ({ request, survey, text }) => ({

when: actions([

Requesting.request,

{ path: "/LikertSurvey/addQuestion", survey, text },

{ request },

]),

then: actions([LikertSurvey.addQuestion, { survey, text }]),

});

  

export const AddQuestionResponse: Sync = ({ request, question }) => ({

when: actions(

[Requesting.request, { path: "/LikertSurvey/addQuestion" }, { request }],

[LikertSurvey.addQuestion, {}, { question }],

),

then: actions([Requesting.respond, { request, question }]),

});
```

```ts
/**

* The Requesting concept exposes passthrough routes by default,

* which allow POSTs to the route:

*

* /{REQUESTING_BASE_URL}/{Concept name}/{action or query}

*

* to passthrough directly to the concept action or query.

* This is a convenient and natural way to expose concepts to

* the world, but should only be done intentionally for public

* actions and queries.

*

* This file allows you to explicitly set inclusions and exclusions

* for passthrough routes:

* - inclusions: those that you can justify their inclusion

* - exclusions: those to exclude, using Requesting routes instead

*/

  

/**

* INCLUSIONS

*

* Each inclusion must include a justification for why you think

* the passthrough is appropriate (e.g. public query).

*

* inclusions = {"route": "justification"}

*/

  

export const inclusions: Record<string, string> = {

"/api/UserAuthentication/register": "allow anyone to register",

"/api/UserAuthentication/authenticate": "allow anyone to authenticate",

"/api/UserAuthentication/_getUserByUsername": "allow anyone to get user by username",

"/api/UserAuthentication/_getUsername": "allow anyone to get username",

};

  

/**

* EXCLUSIONS

*

* Excluded routes fall back to the Requesting concept, and will

* instead trigger the normal Requesting.request action. As this

* is the intended behavior, no justification is necessary.

*

* exclusions = ["route"]

*/

  

export const exclusions: Array<string> = [

"/api/Reaction/add",

"/api/Reaction/remove",

"/api/Reaction/_getReactionsForPost",

"/api/Reaction/_getReactionsByPostAndUser",

"/api/Ranking/addComparison",

"/api/Ranking/remove",

"/api/Ranking/_getRankings",

"/api/Post/create",

"/api/Post/delete",

"/api/Post/_getPostsByAuthor",

"/api/Post/_getPostById",

"/api/SongRecommender/getUserCatalog",

"/api/SongRecommender/addSongToCatalog",

"/api/SongRecommender/generateRecommendation",

"/api/SongRecommender/removeSongsFromCatalog",

"/api/SongRecommender/removeSongsFromPastRecommendations",

"/api/SongRecommender/getPastRecommendations",

"/api/SongRecommender/getNotYetRecommended",

"/api/Sessioning/create",

"/api/Sessioning/delete",

"/api/Sessioning/_getUser",

"/api/Friends/_getCanonicalUsers",

"/api/Friends/sendFriendRequest",

"/api/Friends/acceptFriendRequest",

"/api/Friends/rejectFriendRequest",

"/api/Friends/removeFriend",

"/api/Friends/_verifyFriendship",

"/api/Friends/_getFriends",

"/api/Friends/_getSentRequests",

"/api/Friends/_getReceivedRequests",

"/api/UserAuthentication/delete",

"/api/UserAuthentication/changePassword",

"/api/UserAuthentication/changeUsername",

];
```
